# WebRTC 架构测试指南

## 测试环境准备

### 1. 启动代理服务器
```bash
cd go_proj
go run .
```

服务器将在 `http://localhost:8080` 启动

### 2. 准备测试数据
- 机器人 IP 地址
- 访问令牌
- 确保机器人在同一网络中

## 测试步骤

### 1. 基础连接测试

#### 1.1 访问 WebRTC 客户端
打开浏览器访问：
```
http://localhost:8080/webrtc_client.html
```

#### 1.2 连接机器人
- 输入机器人 IP 地址
- 输入访问令牌
- 点击"连接机器人"
- 观察连接状态变化

**预期结果：**
- 连接状态变为"已连接"
- 控制按钮变为可用状态
- 日志显示连接成功信息

### 2. WebRTC 连接测试

#### 2.1 检查 WebRTC 连接
- 连接成功后，观察日志中的 WebRTC 相关信息
- 检查 ICE 连接状态
- 确认 SDP 协商成功

**预期结果：**
- 日志显示"WebRTC连接建立成功"
- ICE 连接状态为"connected"
- 没有连接错误

#### 2.2 多客户端测试
- 打开多个浏览器窗口
- 在每个窗口中连接到同一个机器人
- 观察是否都能成功连接

**预期结果：**
- 多个客户端都能成功连接
- 每个客户端都有独立的 WebRTC 连接
- 服务器日志显示多个客户端连接

### 3. 视频流测试

#### 3.1 开启视频
- 点击"开启视频"按钮
- 观察视频是否正常显示
- 检查视频质量

**预期结果：**
- 视频正常显示
- 视频质量良好
- 延迟较低

#### 3.2 多客户端视频同步
- 在多个客户端中同时开启视频
- 观察视频是否同步
- 检查视频质量是否一致

**预期结果：**
- 所有客户端都能看到视频
- 视频内容同步
- 视频质量一致

### 4. 控制命令测试

#### 4.1 发送命令
- 选择不同的机器人命令
- 点击"发送命令"
- 观察机器人响应

**预期结果：**
- 命令发送成功
- 机器人执行相应动作
- 日志显示命令执行结果

#### 4.2 快速命令
- 使用快速命令按钮
- 测试各种预设命令
- 观察响应速度

**预期结果：**
- 快速命令响应及时
- 机器人动作正确
- 用户体验良好

### 5. 错误处理测试

#### 5.1 网络断开
- 断开网络连接
- 观察错误处理
- 重新连接网络

**预期结果：**
- 显示适当的错误信息
- 提供重连选项
- 网络恢复后能重新连接

#### 5.2 无效参数
- 输入错误的 IP 地址
- 输入错误的令牌
- 观察错误提示

**预期结果：**
- 显示清晰的错误信息
- 提供修复建议
- 不会导致系统崩溃

### 6. 性能测试

#### 6.1 多客户端性能
- 同时连接 5-10 个客户端
- 观察服务器性能
- 检查内存使用

**预期结果：**
- 服务器稳定运行
- 内存使用合理
- 视频流正常

#### 6.2 长时间运行
- 保持连接 1-2 小时
- 观察系统稳定性
- 检查资源泄漏

**预期结果：**
- 系统稳定运行
- 没有内存泄漏
- 连接保持稳定

## 测试检查清单

### ✅ 基础功能
- [ ] 服务器正常启动
- [ ] 网页正常加载
- [ ] 连接机器人成功
- [ ] WebRTC 连接建立
- [ ] 视频流正常显示
- [ ] 控制命令正常发送

### ✅ 多客户端功能
- [ ] 多个客户端同时连接
- [ ] 每个客户端独立工作
- [ ] 视频流同步
- [ ] 命令响应正常

### ✅ 错误处理
- [ ] 网络断开处理
- [ ] 无效参数处理
- [ ] 连接失败处理
- [ ] 错误信息清晰

### ✅ 性能表现
- [ ] 视频延迟低
- [ ] 系统资源使用合理
- [ ] 长时间运行稳定
- [ ] 多客户端支持良好

## 常见问题解决

### 1. 连接失败
**问题：** 无法连接到机器人
**解决：**
- 检查机器人 IP 地址是否正确
- 确认访问令牌有效
- 检查网络连接
- 查看服务器日志

### 2. 视频不显示
**问题：** 连接成功但视频不显示
**解决：**
- 确认视频流已开启
- 检查浏览器 WebRTC 支持
- 查看浏览器控制台错误
- 尝试刷新页面

### 3. 命令无响应
**问题：** 发送命令后机器人无响应
**解决：**
- 检查命令格式是否正确
- 确认机器人支持该命令
- 查看服务器日志
- 检查网络连接

### 4. 性能问题
**问题：** 视频延迟高或卡顿
**解决：**
- 检查网络带宽
- 优化视频编码参数
- 减少同时连接的客户端数量
- 使用更近的 STUN 服务器

## 测试报告模板

### 测试环境
- 操作系统：
- 浏览器版本：
- 网络环境：
- 机器人型号：

### 测试结果
- 基础功能：✅/❌
- 多客户端功能：✅/❌
- 错误处理：✅/❌
- 性能表现：✅/❌

### 发现的问题
1. 问题描述
2. 重现步骤
3. 影响程度
4. 建议解决方案

### 改进建议
1. 功能改进
2. 性能优化
3. 用户体验提升
4. 安全性增强

## 总结

通过以上测试步骤，可以全面验证新的 WebRTC 架构的功能和性能。测试结果将帮助识别潜在问题并指导后续改进。 